<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Event Registration</title>
    <link rel="stylesheet" href="event_register.css" />
  </head>

  <body>
    <div class="container">
      <h2>Register for Event</h2>
      <form id="eventForm">
        <div class="form-group">
          <label for="name">Full Name</label>
          <input type="text" id="name" disabled />
        </div>

        <div class="form-group">
          <label for="email">Email Address</label>
          <input type="email" id="email" disabled />
        </div>

        <div class="lowerform">
          <div class="form-group">
            <label for="event">Selected Event</label>
            <input type="text" id="event" disabled />
          </div>

          <div class="form-group">
            <label for="charges">Total Charges $</label>
            <input type="text" id="charges" disabled />
          </div>

          <div class="form-group">
            <label for="payment">Payment Method</label>
            <select id="payment" required>
              <option value="Credit Card">Credit Card</option>
              <option value="PayPal">PayPal</option>
              <option value="Bank Transfer">Bank Transfer</option>
            </select>
          </div>

          <div class="form-group">
            <label for="transaction">Transaction ID</label>
            <input
              type="text"
              id="transaction"
              required
              placeholder="Enter your Transaction ID"
            />
          </div>
        </div>

        <button type="submit">Register</button>
      </form>
    </div>

    <div class="popup" id="successPopup" style="display: none">
      <div class="popup-content">
        <p>ðŸŽ‰ Registration Successful! ðŸŽ‰</p>
        <button onclick="closePopup()">OK</button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const eventTitle = urlParams.get("event_title");
        const eventPrice = urlParams.get("event_price");

        document.getElementById("event").value = eventTitle;
        document.getElementById("charges").value = eventPrice;

        fetch("../get_session.php")
          .then((response) => response.json())
          .then((data) => {
            if (data.name && data.email) {
              document.getElementById("name").value = data.name;
              document.getElementById("email").value = data.email;
            } else {
              document.getElementById("name").value = "Guest";
              document.getElementById("email").value = "No Email";
            }
          })
          .catch((error) =>
            console.error("Error fetching session data:", error)
          );

        document
          .getElementById("eventForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            const formData = {
              full_name: document.getElementById("name").value,
              email: document.getElementById("email").value,
              event_title: document.getElementById("event").value,
              event_type: eventPrice > 0 ? "paid" : "free",
              charges: eventPrice,
              payment_method: document.getElementById("payment").value,
              transaction_id: document.getElementById("transaction").value,
            };

            fetch("register_event.php", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  document.getElementById("successPopup").style.display =
                    "flex";
                } else {
                  alert(data.message);
                }
              })
              .catch((error) => console.error("Error:", error));
          });
      });

      function closePopup() {
        document.getElementById("successPopup").style.display = "none";
        window.location.href = "/Event-Hive/allEvents/all-events.html";
      }
    </script>
  </body>
</html>
